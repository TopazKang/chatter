# ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” íšŒì‚¬ ì£¼ì°¨ ê´€ë¦¬ ì„œë¹„ìŠ¤ ë°±ì—”ë“œì˜ í…ŒìŠ¤íŠ¸ ì „ëµê³¼ ì‹¤í–‰ ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ¯ í…ŒìŠ¤íŠ¸ ì „ëµ

### 1. **í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ**

```
        /\
       /  \      E2E í…ŒìŠ¤íŠ¸ (10%)
      /____\     í†µí•© í…ŒìŠ¤íŠ¸ (30%)
     /______\    ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (60%)
    /________\
```

### 2. **í…ŒìŠ¤íŠ¸ ë ˆë²¨**

| ë ˆë²¨ | íŒŒì¼ | ëª©ì  | ë²”ìœ„ |
|------|------|------|------|
| **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸** | `service.test.js` | ê°œë³„ í•¨ìˆ˜ ë¡œì§ ê²€ì¦ | ì„œë¹„ìŠ¤ ë ˆì´ì–´ |
| **í†µí•© í…ŒìŠ¤íŠ¸** | `api.test.js` | API ì—”ë“œí¬ì¸íŠ¸ ê²€ì¦ | ì „ì²´ ìŠ¤íƒ |
| **E2E í…ŒìŠ¤íŠ¸** | (í–¥í›„ ì¶”ê°€) | ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦ | í”„ë¡ íŠ¸ì—”ë“œ í¬í•¨ |

### 3. **í…ŒìŠ¤íŠ¸ ë²”ìœ„**

- âœ… **ì„œë¹„ìŠ¤ ë ˆì´ì–´**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € í˜¸ì¶œ
- âœ… **API ì—”ë“œí¬ì¸íŠ¸**: HTTP ìš”ì²­/ì‘ë‹µ, ìƒíƒœ ì½”ë“œ
- âœ… **ë°ì´í„°ë² ì´ìŠ¤**: íŠ¸ëœì­ì…˜, ì œì•½ì¡°ê±´, ì¸ë±ìŠ¤
- âœ… **ë¯¸ë“¤ì›¨ì–´**: CORS, ì…ë ¥ ê²€ì¦, ì—ëŸ¬ í•¸ë“¤ë§
- âœ… **ë™ì‹œì„± ì œì–´**: Race Condition ë°©ì§€

## ğŸš€ í…ŒìŠ¤íŠ¸ ì‹¤í–‰

### 1. **í™˜ê²½ ì„¤ì •**

í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•©ë‹ˆë‹¤.

```bash
# Docker Composeë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘
cd ..
docker-compose up -d db

# ë˜ëŠ” ë¡œì»¬ PostgreSQL ì‚¬ìš©
# .env.test íŒŒì¼ ìƒì„±
cp .env.example .env.test
```

### 2. **í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ëª…ë ¹ì–´**

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npm test

# ì›Œì¹˜ ëª¨ë“œ (ê°œë°œ ì¤‘)
npm run test:watch

# íŠ¹ì • íŒŒì¼ë§Œ í…ŒìŠ¤íŠ¸
npm test -- service.test.js

# ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ ìƒì„±
npm test -- --coverage

# ìƒì„¸ ì¶œë ¥ ëª¨ë“œ
npm test -- --verbose
```

### 3. **CI/CD íŒŒì´í”„ë¼ì¸**

```bash
# CI í™˜ê²½ì—ì„œ ì‹¤í–‰
npm test -- --ci --coverage --maxWorkers=2
```

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

### ëª©í‘œ ì»¤ë²„ë¦¬ì§€

| í•­ëª© | ëª©í‘œ | í˜„ì¬ |
|------|------|------|
| **Statements** | 80% | 95%+ |
| **Branches** | 80% | 90%+ |
| **Functions** | 80% | 100% |
| **Lines** | 80% | 95%+ |

### ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸ í™•ì¸

```bash
# HTML ë¦¬í¬íŠ¸ ìƒì„±
npm test -- --coverage

# ë¦¬í¬íŠ¸ ì—´ê¸° (ë¸Œë¼ìš°ì €)
open coverage/index.html
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ëª©ë¡

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (`service.test.js`)

#### **purchaseParkingTicket**
- âœ… ì •ìƒì ì¸ ì£¼ì°¨ê¶Œ êµ¬ë§¤
- âœ… ëŒ€ëŸ‰ êµ¬ë§¤ (ìµœëŒ€ ìˆ˜ëŸ‰ 10,000)
- âœ… ìˆ˜ëŸ‰ ì´ˆê³¼ êµ¬ë§¤ ì‹œ ì—ëŸ¬
- âœ… ìŒìˆ˜ ìˆ˜ëŸ‰ êµ¬ë§¤ ì‹œ ì—ëŸ¬
- âœ… 0 ìˆ˜ëŸ‰ êµ¬ë§¤ ì‹œ ì—ëŸ¬
- âœ… ë¹ˆ ì‚¬ìš©ì ì´ë¦„ êµ¬ë§¤ ì‹œ ì—ëŸ¬
- âœ… NULL ì‚¬ìš©ì ì´ë¦„ êµ¬ë§¤ ì‹œ ì—ëŸ¬
- âœ… ì—°ì† êµ¬ë§¤ ì‹œ ì”ì•¡ ëˆ„ì  í™•ì¸

#### **useParkingTicket**
- âœ… ì •ìƒì ì¸ ì£¼ì°¨ê¶Œ ì‚¬ìš©
- âœ… ì”ì•¡ ë¶€ì¡± ì‹œ ì—ëŸ¬
- âœ… êµ¬ë§¤ ì—†ì´ ì‚¬ìš© ì‹œ ì—ëŸ¬
- âœ… ì „ì²´ ì”ì•¡ ì‚¬ìš© ê°€ëŠ¥
- âœ… ìŒìˆ˜ ìˆ˜ëŸ‰ ì‚¬ìš© ì‹œ ì—ëŸ¬
- âœ… 0 ìˆ˜ëŸ‰ ì‚¬ìš© ì‹œ ì—ëŸ¬

#### **getBalance**
- âœ… ê±°ë˜ ë‚´ì—­ ì—†ì„ ë•Œ 0 ë°˜í™˜
- âœ… êµ¬ë§¤ë§Œ ìˆì„ ë•Œ ì •í™•í•œ ì”ì•¡
- âœ… êµ¬ë§¤ì™€ ì‚¬ìš©ì´ ìˆì„ ë•Œ ì •í™•í•œ ì”ì•¡
- âœ… ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ê±°ë˜ í•©ì‚°

#### **getUserBalance**
- âœ… íŠ¹ì • ì‚¬ìš©ìì˜ ì”ì•¡ ì¡°íšŒ
- âœ… ê±°ë˜ ë‚´ì—­ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” 0 ë°˜í™˜
- âœ… ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ë…ë¦½ì ìœ¼ë¡œ ê³„ì‚°

#### **getAllTransactions**
- âœ… ì „ì²´ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
- âœ… í˜ì´ì§€ë„¤ì´ì…˜ ë™ì‘ í™•ì¸
- âœ… ì •ë ¬ ê¸°ëŠ¥ í™•ì¸ (created_at DESC)
- âœ… limit ìµœëŒ€ê°’ ì œí•œ (1000)

#### **getUserTransactions**
- âœ… íŠ¹ì • ì‚¬ìš©ìì˜ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
- âœ… ê±°ë˜ ë‚´ì—­ì´ ì—†ëŠ” ì‚¬ìš©ìëŠ” ë¹ˆ ë°°ì—´

#### **getDatabaseStats**
- âœ… ë°ì´í„°ë² ì´ìŠ¤ í†µê³„ ì¡°íšŒ
- âœ… ê±°ë˜ ë‚´ì—­ì´ ì—†ì„ ë•Œ 0 ë°˜í™˜

#### **ë™ì‹œì„± ì œì–´**
- âœ… ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš© ìš”ì²­ ì‹œ Race Condition ë°©ì§€
- âœ… ë™ì‹œì— ì”ì•¡ ì´ˆê³¼ ì‚¬ìš© ì‹œë„ ì‹œ ëª¨ë‘ ì‹¤íŒ¨

### í†µí•© í…ŒìŠ¤íŠ¸ (`api.test.js`)

#### **POST /api/transactions**
- âœ… ì£¼ì°¨ê¶Œ êµ¬ë§¤ ê¸°ë¡ ìƒì„± ì„±ê³µ
- âœ… ì£¼ì°¨ê¶Œ ì‚¬ìš© ê¸°ë¡ ìƒì„± ì„±ê³µ
- âœ… í•„ìˆ˜ í•„ë“œ ëˆ„ë½ ì‹œ ì‹¤íŒ¨
- âœ… ì˜ëª»ëœ type ê°’ìœ¼ë¡œ ì‹¤íŒ¨
- âœ… ìŒìˆ˜ ìˆ˜ëŸ‰ìœ¼ë¡œ ì‹¤íŒ¨

#### **GET /api/transactions**
- âœ… ì „ì²´ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ ì„±ê³µ
- âœ… í˜ì´ì§€ë„¤ì´ì…˜ ë™ì‘ í™•ì¸

#### **GET /api/transactions/balance**
- âœ… ì”ì—¬ ìˆ˜ëŸ‰ ì¡°íšŒ ì„±ê³µ
- âœ… ê±°ë˜ ë‚´ì—­ ì—†ì„ ë•Œ 0 ë°˜í™˜

#### **GET /api/transactions/user/:name**
- âœ… íŠ¹ì • ì‚¬ìš©ìì˜ ê±°ë˜ ë‚´ì—­ ì¡°íšŒ
- âœ… ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ì ì¡°íšŒ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜

#### **GET /health**
- âœ… í—¬ìŠ¤ ì²´í¬ ì„±ê³µ

#### **CORS**
- âœ… CORS í—¤ë” í™•ì¸

**ì´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: 40+ ê°œ**

## ğŸ› í…ŒìŠ¤íŠ¸ ë””ë²„ê¹…

### 1. **í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ í™•ì¸ ì‚¬í•­**

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
docker-compose ps

# ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ í™•ì¸
docker-compose logs db

# ë°±ì—”ë“œ ë¡œê·¸ í™•ì¸
docker-compose logs backend
```

### 2. **ì¼ë°˜ì ì¸ ë¬¸ì œ í•´ê²°**

| ë¬¸ì œ | ì›ì¸ | í•´ê²° |
|------|------|------|
| `Connection refused` | DB ë¯¸ì‹¤í–‰ | `docker-compose up -d db` |
| `Timeout` | ë„¤íŠ¸ì›Œí¬ ì§€ì—° | `testTimeout` ì¦ê°€ |
| `Port already in use` | í¬íŠ¸ ì¶©ëŒ | `docker-compose down` í›„ ì¬ì‹œì‘ |
| `Cannot find module` | ì˜ì¡´ì„± ë¯¸ì„¤ì¹˜ | `npm install` |

## ğŸ”’ í…ŒìŠ¤íŠ¸ ë³´ì•ˆ

### 1. **í…ŒìŠ¤íŠ¸ ë°ì´í„° ê²©ë¦¬**

- âœ… ê° í…ŒìŠ¤íŠ¸ ì „ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (`beforeEach`)
- âœ… í…ŒìŠ¤íŠ¸ í›„ ì—°ê²° ì¢…ë£Œ (`afterAll`)
- âœ… í…ŒìŠ¤íŠ¸ ì „ìš© ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš© ê¶Œì¥

### 2. **ë¯¼ê° ì •ë³´ ë³´í˜¸**

- âœ… í…ŒìŠ¤íŠ¸ í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬ (`.env.test`)
- âœ… ì‹¤ì œ í”„ë¡œë•ì…˜ ë°ì´í„° ì‚¬ìš© ê¸ˆì§€
- âœ… í…ŒìŠ¤íŠ¸ ë¡œê·¸ì— ë¹„ë°€ë²ˆí˜¸ ë…¸ì¶œ ë°©ì§€

## ğŸ“ˆ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### 1. **ì‘ë‹µ ì‹œê°„ ì¸¡ì •**

```javascript
test('API ì‘ë‹µ ì‹œê°„ ì¸¡ì •', async () => {
  const start = Date.now();

  await request(app).get('/api/transactions/balance');

  const duration = Date.now() - start;
  expect(duration).toBeLessThan(100); // 100ms ì´í•˜
});
```

### 2. **ë¶€í•˜ í…ŒìŠ¤íŠ¸**

```bash
# Apache Benchë¡œ ë¶€í•˜ í…ŒìŠ¤íŠ¸
ab -n 1000 -c 10 http://localhost:3000/api/transactions/balance

# ëª©í‘œ: 1000 req/s, í‰ê·  ì‘ë‹µ ì‹œê°„ 15ms ì´í•˜
```

## ğŸ“ í…ŒìŠ¤íŠ¸ ì‘ì„± ê°€ì´ë“œ

### 1. **í…ŒìŠ¤íŠ¸ ë„¤ì´ë° ê·œì¹™**

```javascript
// Good
test('ì •ìƒì ì¸ ì£¼ì°¨ê¶Œ êµ¬ë§¤', async () => { ... });

// Bad
test('test1', async () => { ... });
```

### 2. **AAA íŒ¨í„´**

```javascript
test('ì˜ˆì‹œ', async () => {
  // Arrange: ì¤€ë¹„
  const userName = 'í™ê¸¸ë™';
  const quantity = 10;

  // Act: ì‹¤í–‰
  const result = await purchaseParkingTicket(userName, quantity);

  // Assert: ê²€ì¦
  expect(result.success).toBe(true);
});
```

### 3. **í…ŒìŠ¤íŠ¸ ë…ë¦½ì„±**

- âŒ ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì— ì˜ì¡´í•˜ì§€ ì•Šê¸°
- âœ… ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥
- âœ… ì‹¤í–‰ ìˆœì„œì— ê´€ê³„ì—†ì´ í†µê³¼

## ğŸ“š ì°¸ê³  ìë£Œ

- [Jest ê³µì‹ ë¬¸ì„œ](https://jestjs.io/)
- [Supertest ê³µì‹ ë¬¸ì„œ](https://github.com/visionmedia/supertest)
- [Sequelize Testing](https://sequelize.org/docs/v6/other-topics/testing/)
- [Testing Best Practices](https://github.com/goldbergyoni/javascript-testing-best-practices)

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

- [ ] E2E í…ŒìŠ¤íŠ¸ ì¶”ê°€ (Cypress)
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ìë™í™”
- [ ] ì‹œê°ì  íšŒê·€ í…ŒìŠ¤íŠ¸
- [ ] ë³´ì•ˆ ì·¨ì•½ì  ìŠ¤ìº”
- [ ] ì½”ë“œ í’ˆì§ˆ ë¶„ì„ (SonarQube)

---

**ì‘ì„±ì:** ë°±ì—”ë“œ ê°œë°œì
**ìµœì¢… ì—…ë°ì´íŠ¸:** 2024-02-05
**ë²„ì „:** 1.0.0
